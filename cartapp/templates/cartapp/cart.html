<!DOCTYPE html>
<html>
<head>
    <title>Cart</title>
    <script>
        function updateTotal() {
            var total = 0
            var quantities = document.getElementsByName("quantity");
            var prices = document.getElementsByName("price");
            for (var i = 0; i < quantities.length; i++) {
                var quantity = quantities[i].value;
                var price = prices[i].innerHTML;
                total += quantity * price;
                localStorage.setItem('quantity' + i, quantity); // 添加这一行代码
            }
            document.getElementById("total").innerHTML = total.toFixed(2);
        }
        document.addEventListener('DOMContentLoaded', function() { // 添加这一段代码
            {% for cart_item in cart_items %}
                var quantity = localStorage.getItem('quantity{{ cart_item.product_id }}');
                if (quantity !== null) {
                    document.getElementById('quantity{{ cart_item.product_id }}').value = quantity;
                }
            {% endfor %}
            updateTotal();
        });
    </script>
</head>
<body>
    <h1>Cart Items</h1>
    <table>
        <thead>
            <tr>
                <th>Product ID</th>
                <th>Price</th>
                <th>Promotion Name</th>
                <th>Sales Country</th>
                <th>Quantity</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for cart_item in cart_items %}
            <tr>
                <td>{{ cart_item.product_id }}</td>
                <td name="price">{{ cart_item.price }}</td>
                <td>{{ cart_item.promotion_name }}</td>
                <td>{{ cart_item.sales_country }}</td>
                <td>
                    <select id="quantity{{ cart_item.product_id }}" name="quantity" onchange="updateTotal()">
                        <option value="0"{% if cart_item.quantity == 0 %} selected{% endif %}>0</option>
                        <option value="1"{% if cart_item.quantity == 1 %} selected{% endif %}>1</option>
                        <option value="2"{% if cart_item.quantity == 2 %} selected{% endif %}>2</option>
                        <option value="3"{% if cart_item.quantity == 3 %} selected{% endif %}>3</option>
                        <option value="4"{% if cart_item.quantity == 4 %} selected{% endif %}>4</option>
                        <option value="5"{% if cart_item.quantity == 5 %} selected{% endif %}>5</option>
                    </select>
                </td>
                <td>
                    <a href="{% url 'delete_cart_item' cart_item.product_id %}">删除</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div>
        Total: $<span id="total">0.00</span>
    </div>
</body>
</html>
